# ![20181224143252563.png](https://cdn.nlark.com/yuque/0/2020/png/450005/1585703150841-81275724-73a7-48ff-a989-4aaeba61369c.png#align=left&display=inline&height=487&originHeight=487&originWidth=646&size=126790&status=done&style=none&width=646)
# TCP 和 UDP
TCP 和 UDP 是**传输层协议**。
TCP/IP 是互联网相关的各类协议族的总称，比如：TCP，UDP，IP，FTP，HTTP，ICMP，SMTP 等都属于 TCP/IP 族内的协议。
TCP/IP 模型是互联网的基础，它是一系列网络协议的总称。这些协议可以划分为四层，分别为**链路层、网络层、传输层和应用层。**

- 链路层：负责封装和解封装IP报文，发送和接受ARP/RARP报文等。
- 网络层：负责路由以及把分组报文发送给目标网络或主机。
- 传输层：负责对报文进行分组和重组，并以TCP或UDP协议格式封装报文。
- 应用层：负责向用户提供应用程序，比如HTTP、FTP、Telnet、DNS、SMTP等。

## TCP
**TCP** 协议全称是传输控制协议。是一种**面向连接的、可靠的、基于字节流**的传输层通信协议。

### TCP 的连接过程
TCP 的连接过程为**三次握手**
**
**第一次握手**
客户端向服务端发送连接请求报文段。该报文段中包含自身的数据通讯初始序号，发送后，客户端进入 SYN-SEND 状态。

**第二次握手**
服务端收到请求后，如果同意，会给客户端发送一个应答，该应答中也会包含自身的数据通讯初始序号，发送完成后服务端便进入 SYN-RECEIVED 状态。

**第三次握手**
客户端收到服务端的连接同意的应答后，还要向服务端发送一个确认报文。客户端发完这个报文段后便进入 ESTABLISHED 状态，服务端收到这个应答后也进入 ESTABLISHED 状态，此时连接建立成功。
![2019-03-21-04.png](https://cdn.nlark.com/yuque/0/2020/png/450005/1585703831415-62784524-b132-4ab4-82d5-74a3454b9f0e.png#align=left&display=inline&height=344&originHeight=344&originWidth=553&size=116488&status=done&style=none&width=553)

**为什么 TCP 建立连接需要三次握手，而不是两次？**这是因为这是为了防止出现失效的连接请求报文段被服务端接收的情况，从而产生错误。

### TCP 断开连接过程
**第一次握手**
若客户端认为数据发送完成，则它需要向服务端发送**连接释放请求**。

**第二次握手**
服务端收到连接释放请求后，会告诉应用层要释放 TCP 链接。然后会向客户端发送 ACK 包，并进入 CLOSE_WAIT 状态，此时表明 **客户端 到 服务端 的连接已经释放**，不再接收 **客户端** 发的数据了。**但是因为 TCP 连接是双向的，所以 服务端 仍旧可以发送数据给 客户端。**
**
**第三次握手**
服务端 如果此时还有没发完的数据会继续发送，完毕后会向 客户端 发送连接释放请求，然后 服务端 便进入 LAST-ACK 状态。

**第四次握手**
客户端 收到服务端的释放请求后，向 服务端 **发送确认应答**，此时 客户端 进入 TIME-WAIT 状态。该状态会持续 2MSL（最大段生存期，指报文段在网络中生存的时间，超时会被抛弃） 时间，若该时间段内没有 服务端 的重发请求的话，就进入 CLOSED 状态。当 服务端 收到确认应答后，也便进入 CLOSED 状态。

![2019-03-21-06.png](https://cdn.nlark.com/yuque/0/2020/png/450005/1585704379496-40ac0783-b0e3-4a39-ac98-1d418fb82d2f.png#align=left&display=inline&height=414&originHeight=414&originWidth=553&size=35147&status=done&style=none&width=553)
TCP 是全双工的，在断开连接时两端都需要发送 FIN 和 ACK。

## UDP协议
全称是用户数据报协议，是一种无连接的协议。在OSI模型中，在第四层——传输层，处于IP协议的上一层。
UDP 有不提供数据包分组、组装和不能对数据包进行排序的缺点，也就是说，**当报文发送之后，是无法得知其是否安全完整到达的。**

UDP 协议面向无连接，不需要和 TCP 一样在发送数据前进行三次握手建立连接的，想发数据就可以开始发送了。并且也只是数据报文的搬运工，不会对数据报文进行任何拆分和拼接操作。

UDP 不止支持一对一的传输方式，同样**支持一对多，多对多，多对一的方式**，也就是说 UDP 提供了单播，多播，广播的功能

UDP 不可靠性体现在无连接上，通信都不需要建立连接，想发就发，这样的情况肯定不可靠。并且收到什么数据就传递什么数据，并且也不会备份数据，发送数据也不会关心对方是否已经正确接收到数据了。

优点：在某些实时性要求高的场景（比如电话会议）就需要使用 UDP 而不是 TCP。

## TCP 和 UDP 对比
|  | UDP | TCP |
| --- | :--- | :--- |
| 是否连接 | 无连接 | 面向连接 |
| 是否可靠 | 不可靠传输，不使用流量控制和拥塞控制 | 可靠传输，使用流量控制和拥塞控制 |
| 连接对象个数 | 支持一对一，一对多，多对一和多对多交互通信 | 只能是一对一通信 |
| 传输方式 | 面向报文 | 面向字节流 |
| 首部开销 | 首部开销小，仅8字节 | 首部最小20字节，最大60字节 |
| 适用场景 | 适用于实时应用（IP电话、视频会议、直播等） | 适用于要求可靠传输的应用，例如文件传输 |


## 小结

- TCP向上层提供面向连接的可靠服务 ，UDP向上层提供无连接不可靠服务。
- 虽然 UDP 并没有 TCP 传输来的准确，但是也能在很多实时性要求高的地方有所作为
- 对数据准确性要求高，速度可以相对较慢的，可以选用TCP



# Http 和 Https
HTTP 是超文本传输协议，HTTPS 可理解为 HTTP+SSL+TLS，SSL （Secure Socket Layer，安全套接字层），TLS（Transport Layer Security，传输层安全）

HTTP 在传输的过程中是不加密的，即明文传输，所以很容易被黑客攻击：

![https-20170330-4.png](https://cdn.nlark.com/yuque/0/2020/png/450005/1585706460440-fd1a2f2e-bdaf-4725-a82d-0610b587fdc3.png#align=left&display=inline&height=184&originHeight=184&originWidth=489&size=38982&status=done&style=none&width=489)

所以 HTTP 传输面临的风险有：

- 窃听风险：黑客可以获知通信内容。
- 篡改风险：黑客可以修改通信内容。
- 冒充风险：黑客可以冒充他人身份参与通信。

**HTTP 向 HTTPS 演化的过程**
**
为了防止以上事情发生，可以给传输的内容加密：

![https-20170330-6.png](https://cdn.nlark.com/yuque/0/2020/png/450005/1585706728605-9ddc0d7f-7045-40ea-8fea-4214d5f2cca3.png#align=left&display=inline&height=212&originHeight=212&originWidth=450&size=42224&status=done&style=none&width=450)

此种方式属于**对称加密，双方拥有相同的密钥**，信息得到安全传输，但此种方式的缺点是：

- 不同的客户端、服务器数量庞大，所以双方都需要维护大量的密钥，维护成本很高
- 因每个客户端、服务器的安全级别不同，密钥极易泄露

既然使用对称加密时，密钥维护这么繁琐，那我们就用非对称加密试试：

![https-20170330-7.png](https://cdn.nlark.com/yuque/0/2020/png/450005/1585706921294-9c454a91-c62b-47b3-881c-4a36d0c81485.png#align=left&display=inline&height=238&originHeight=238&originWidth=475&size=43301&status=done&style=none&width=475)

**客户端用公钥对请求内容加密，服务器使用私钥对内容解密，反之亦然**，但上述过程也存在缺点：
公钥是公开的（也就是黑客也会有公钥），所以第 ④ 步私钥加密的信息，如果被黑客截获，其可以使用公钥进行解密，获取其中的内容。

非对称加密既然也有缺陷，那我们就将对称加密，非对称加密两者结合起来，取其精华、去其糟粕，发挥两者的各自的优势：

![https-20170330-8.png](https://cdn.nlark.com/yuque/0/2020/png/450005/1585708516467-4f7d958c-efe3-47b4-b0ef-85b05ad03c4b.png#align=left&display=inline&height=352&originHeight=352&originWidth=558&size=77249&status=done&style=none&width=558)

（1）第 ③ 步时，客户端说：（咱们后续回话采用对称加密吧，这是对称加密的算法和对称密钥）这段话用公钥进行加密，然后传给服务器
（2）服务器收到信息后，用私钥解密，提取出对称加密算法和对称密钥后，服务器说：（好的）对称密钥加密
（3）后续两者之间信息的传输就可以使用对称加密的方式了
遇到的问题：
（1）客户端如何获得公钥
（2）如何确认服务器是真实的而不是黑客

获取公钥与确认服务器身份

![https-20170330-10.png](https://cdn.nlark.com/yuque/0/2020/png/450005/1585708676076-ffc174b1-db10-4327-af89-91522301a924.png#align=left&display=inline&height=362&originHeight=362&originWidth=567&size=80543&status=done&style=none&width=567)

在第 ② 步时服务器发送了一个 SSL 证书给客户端，SSL 证书中包含的具体内容有：
（1）证书的发布机构CA
（2）证书的有效期
（3）公钥
（4）证书所有者
（5）签名
………
 客户端在接受到服务端发来的 SSL 证书时，会对证书的真伪进行校验，以浏览器为例说明如下： 

（1）首先浏览器读取证书中的证书所有者、有效期等信息进行一一校验
（2）浏览器开始查找[操作系统](http://lib.csdn.net/base/operatingsystem)中已内置的受信任的证书发布机构CA，与服务器发来的证书中的颁发者CA比对，用于校验证书是否为合法机构颁发 
（3）如果找不到，浏览器就会报错，说明服务器发来的证书是不可信任的。
（4）如果找到，那么浏览器就会从操作系统中取出  颁发者CA  的公钥，然后对服务器发来的证书里面的签名进行解密
（5）浏览器使用相同的hash算法计算出服务器发来的证书的hash值，将这个计算的hash值与证书中签名做对比
（6）对比结果一致，则证明服务器发来的证书合法，没有被冒充
（7）此时浏览器就可以读取证书中的公钥，用于后续加密了

**HTTPS优点：**
相比 HTTP 协议，HTTPS 协议增加了很多握手、加密解密等流程，虽然过程很复杂，但其可以保证数据传输的安全。所以在这个互联网膨胀的时代，其中隐藏着各种看不见的危机，为了保证数据的安全，维护网络稳定，建议大家多多推广HTTPS。

**HTTPS 缺点：**
（1）SSL 证书费用很高，以及其在服务器上的部署、更新维护非常繁琐
（2）HTTPS 降低用户访问速度（多次握手）
（3）网站改用HTTPS 以后，由HTTP 跳转到 HTTPS 的方式增加了用户访问耗时（多数网站采用302跳转）
（4）HTTPS 涉及到的安全算法会消耗 CPU 资源，需要增加大量机器（https访问过程需要加解密）


TCP 和 UDP 使用 IP 协议从一个网络传送数据包到另一个网络。
把 IP 想像成一种高速公路，它允许其它协议在上面行驶并找到到其它电脑的出口。TCP 和 UDP 是高速公路上的“卡车”，它们携带的货物就是像 HTTP，文件传输协议 FTP 这样的协议等。
Socket 是 TCP/IP 协议的上层 API，Socket 接口定义了许多函数或例程，用以开发TCP/IP网络上的应用程序。



